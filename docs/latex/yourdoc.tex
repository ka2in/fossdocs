%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[a4paper,10pt,english,openany,oneside]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother

\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjornstrup]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}
\usepackage[bottom]{footmisc}

\title{bits4docs Documentation}
\date{May 25, 2022}
\release{1.0}
\author{GlobalTech Translations}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}
\begin{sloppypar}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxAtStartPar
You will find here FOSS tutorials about the following topics:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Technical communication

\item {} 
\sphinxAtStartPar
Software documentation

\item {} 
\sphinxAtStartPar
Front/backend web development

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{About the author:}

\sphinxAtStartPar
Fayçal Alami\sphinxhyphen{}Hassani \sphinxhyphen{} \sphinxhref{https://globaltech-translations.com}{@GlobalTech Translations}%
\begin{footnote}[1]\sphinxAtStartFootnote
\sphinxnolinkurl{https://globaltech-translations.com}
%
\end{footnote} \sphinxhyphen{} \sphinxhref{https://fosstodon.org/@gnufcl}{@gnufcl@fosstodon.org}%
\begin{footnote}[2]\sphinxAtStartFootnote
\sphinxnolinkurl{https://fosstodon.org/@gnufcl}
%
\end{footnote}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Technical communicator, translator and interpreter

\item {} 
\sphinxAtStartPar
Markup: reStructuredText, Markdown, DocBook, XML

\item {} 
\sphinxAtStartPar
Web development: HTML, CSS, PHP, MySQL, JavaScript, jQuery

\item {} 
\sphinxAtStartPar
Text editors: Nano, Atom, Sublime Text

\item {} 
\sphinxAtStartPar
Version control: Git, CVS

\item {} 
\sphinxAtStartPar
OS: Debian, Fedora

\item {} 
\sphinxAtStartPar
Now learning: Docs\sphinxhyphen{}as\sphinxhyphen{}Code based on \sphinxhref{https://antora.org/}{Antora}%
\begin{footnote}[3]\sphinxAtStartFootnote
\sphinxnolinkurl{https://antora.org/}
%
\end{footnote} with \sphinxhref{https://asciidoc-py.github.io/}{AsciiDoc}%
\begin{footnote}[4]\sphinxAtStartFootnote
\sphinxnolinkurl{https://asciidoc-py.github.io/}
%
\end{footnote}

\item {} 
\sphinxAtStartPar
Currently reading:
\begin{quote}

\sphinxAtStartPar
📕 Web Security for Developers \sphinxhyphen{} Real Threats, Practical Defense \sphinxhyphen{} Malcolm McDonald \sphinxhyphen{} No Starch Press \sphinxhyphen{} ISBN: 978\sphinxhyphen{}1\sphinxhyphen{}59327\sphinxhyphen{}994\sphinxhyphen{}3

\sphinxAtStartPar
📕 Eloquent JavaScript \sphinxhyphen{} A Modern Introduction to Programming \sphinxhyphen{} Marijn Haverbeke \sphinxhyphen{} No Starch Press \sphinxhyphen{} ISBN: 978\sphinxhyphen{}1\sphinxhyphen{}59327950\sphinxhyphen{}9
\end{quote}

\end{itemize}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
This project is under active development. If you have any questions, please send an email to: info{[}@{]}globaltech\sphinxhyphen{}translations{[}.{]}com \sphinxhyphen{} \sphinxcode{\sphinxupquote{PGP KeyID: 0x52D6AF10}}
\end{sphinxadmonition}

\sphinxstepscope


\chapter{Migrating a Joomla website from shared hosting to an unmanaged VPS}
\label{\detokenize{joomla-to-vps:migrating-a-joomla-website-from-shared-hosting-to-an-unmanaged-vps}}\label{\detokenize{joomla-to-vps::doc}}
\sphinxAtStartPar
Published on May 11, 2022 by Fayçal Alami\sphinxhyphen{}Hassani \sphinxhref{https://fosstodon.org/@gnufcl}{@gnufcl@fosstodon.org}%
\begin{footnote}[5]\sphinxAtStartFootnote
\sphinxnolinkurl{https://fosstodon.org/@gnufcl}
%
\end{footnote}

\begin{figure}[H]
\centering
\capstart

\noindent\sphinxincludegraphics{{talk-to-me-mini}.jpg}
\caption{Picture by Stéphane Wootha Richard under \sphinxhref{https://creativecommons.org/licenses/by-sa/4.0/deed.en}{CC BY\sphinxhyphen{}SA 4.0}\sphinxfootnotemark[6] License}\label{\detokenize{joomla-to-vps:id1}}\end{figure}
%
\begin{footnotetext}[6]\phantomsection\label{\thesphinxscope.6}%
\sphinxAtStartFootnote
\sphinxnolinkurl{https://creativecommons.org/licenses/by-sa/4.0/deed.en}
%
\end{footnotetext}\ignorespaces 
\sphinxAtStartPar
Migrating a website from a shared hosting plan to an unmanaged VPS might seem a daunting task at the beginning. Depending on your acquaintance with server administration, it may take you a few days to several weeks to gather all the relevant information and organize the required steps in a structured, logical way to set up a custom migration project.

\sphinxAtStartPar
There are plenty of resources about the topic, both online and offline. However, most of them only describe a tiny part of the entire process.

\sphinxAtStartPar
The biggest challenges that you might face when migrating from shared hosting to an unmanaged VPS are related to the following topics:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Software stack to use, i.e. operating system, database technology, web server, and programming language.

\item {} 
\sphinxAtStartPar
Backup, data transfer, and restore strategy.

\item {} 
\sphinxAtStartPar
Choosing between server administration with the Linux command line (CLI) or GUI\sphinxhyphen{}based hosting panels such as cPanel, Plesk, and Froxlor.

\item {} 
\sphinxAtStartPar
User permission management.

\item {} 
\sphinxAtStartPar
DNS settings and configuration.

\item {} 
\sphinxAtStartPar
Testing the website before the actual domain transfer.

\item {} 
\sphinxAtStartPar
SSL certificate management.

\end{itemize}

\sphinxAtStartPar
In this tutorial, you will learn how to migrate a Joomla website from a shared hosting provider to an unmanaged VPS server.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
When we talk about virtual private servers (VPS), we distinguish between two main categories: \sphinxstyleemphasis{managed} vs. \sphinxstyleemphasis{unmanaged} VPS. Put in a few words, An unmanaged VPS plan gives you full control over the technical aspects of your server management and administration. There is no technical support to resolve issues and you are responsible for maintaining your server, including the installation of patches and updates, among other things.
\end{sphinxadmonition}


\section{Prerequisites}
\label{\detokenize{joomla-to-vps:prerequisites}}\label{\detokenize{joomla-to-vps:requirements}}
\sphinxAtStartPar
This tutorial assumes that you already have the following:
\begin{itemize}
\item {} 
\sphinxAtStartPar
LAMP stack installed on your VPS server. LAMP is short for “Linux + Apache + MySQL + PHP”.

\item {} 
\sphinxAtStartPar
Non\sphinxhyphen{}root user with sudo privileges on your VPS server.

\item {} 
\sphinxAtStartPar
SSH access to your VPS server.

\end{itemize}

\sphinxAtStartPar
Before you follow this guide, make sure to configure your environment accordingly.


\section{Performing the backup on your shared hosting account}
\label{\detokenize{joomla-to-vps:performing-the-backup-on-your-shared-hosting-account}}\label{\detokenize{joomla-to-vps:credentials}}
\sphinxAtStartPar
To backup your website files and the corresponding database, follow these steps:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Login to your shared hosting account.

\item {} 
\sphinxAtStartPar
In your cPanel, go to \sphinxstylestrong{File Manager} > \sphinxstylestrong{public\_html}.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{file-manager-cpanel}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
Inside the \sphinxstylestrong{public\_html} directory, check your database login credentials in the file ‘configuration.php’. You should look for the following entries:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{public \$user}}: Database user name

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{public \$password}}: Database password

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{public \$db}}: Database name

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{public \$dbprefix}}: Database prefix
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{public-html}.png}
\end{figure}
\end{quote}

\end{itemize}

\item {} 
\sphinxAtStartPar
In the cPanel main menu, go to \sphinxstylestrong{Backup} > \sphinxstylestrong{Databases} > \sphinxstylestrong{MySQL® Database Wizard}.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{mysql-database-wizard}.png}
\end{figure}
\end{quote}

\sphinxAtStartPar
The Backup Wizard provides multiple options. Select \sphinxstylestrong{Full or Partial Backup} > \sphinxstylestrong{Select Partial Backup} > \sphinxstylestrong{MySQL Databases}. This will allow you to download a backup of the MySQL database(s) of your Joomla website to your local machine.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{partial-backup-db}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
Login to the backend of your Joomla website.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{backend-login-joomla}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
To backup the website files, we will use an extension called \sphinxhref{https://www.akeeba.com/products/akeeba-backup.html}{Akeeba Backup}%
\begin{footnote}[7]\sphinxAtStartFootnote
\sphinxnolinkurl{https://www.akeeba.com/products/akeeba-backup.html}
%
\end{footnote}.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{akeeba-backup-backend}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
Before making a backup with akeeba, make sure to \phantomsection\label{\detokenize{joomla-to-vps:disable-ssl}}disable SSL. To do so, navigate to \sphinxstylestrong{System} > \sphinxstylestrong{Global Configuration} > \sphinxstylestrong{Server} > \sphinxstylestrong{Force HTTPS}. Select the option \sphinxstylestrong{None} from the drop\sphinxhyphen{}down menu.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{global-configuration-joomla}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
Next, go to \sphinxstylestrong{Components} > \sphinxstylestrong{Akeeba Backup} > \sphinxstylestrong{One\sphinxhyphen{}Click Backup} > \sphinxstylestrong{Default Backup Profile}
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{akeeba-backup-demo}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
Once the backup process has completed, click on the “\sphinxstylestrong{i}” button below the green “\sphinxstylestrong{Download}” button on the right to display your “\sphinxstylestrong{Backup Archive Information}”.
\begin{quote}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
An Akeeba backup file has a \sphinxcode{\sphinxupquote{.jpa}} extension.
\end{sphinxadmonition}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{akeeba-backup-management}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
In your shared hosting account, navigate to the location of your Akeeba backup file through \sphinxstylestrong{File Manager} > \sphinxstylestrong{public\_html} > \sphinxstylestrong{path\sphinxhyphen{}to\sphinxhyphen{}akeeba\sphinxhyphen{}backup}. Download the .jpa file to your local machine.

\item {} 
\sphinxAtStartPar
Now that you have downloaded your backup file, you need to re\sphinxhyphen{}enable SSL for your entire website. On your shared hosting account, navigate to the folder \sphinxcode{\sphinxupquote{public\_html}} and open the file “configuration.php”.

\sphinxAtStartPar
Search for the entry \sphinxcode{\sphinxupquote{public \$force\_ssl}} and switch the value from 0 to 2:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{x}{public \PYGZdl{}force\PYGZus{}ssl = 2}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Save your changes and return to your Joomla Backend. Go to \sphinxstylestrong{System} > \sphinxstylestrong{Global Configuration} > \sphinxstylestrong{Server}.

\item {} 
\sphinxAtStartPar
Navigate to the option \sphinxstylestrong{Force HTTPS} and select \sphinxstylestrong{Entire Site} from the drop\sphinxhyphen{}down menu.

\item {} 
\sphinxAtStartPar
Download the \sphinxhref{https://www.akeeba.com/products/akeeba-kickstart.html}{Akeeba Kickstart Core}%
\begin{footnote}[8]\sphinxAtStartFootnote
\sphinxnolinkurl{https://www.akeeba.com/products/akeeba-kickstart.html}
%
\end{footnote} by clicking on the button \sphinxstylestrong{Download Core}.

\item {} 
\sphinxAtStartPar
In the next page that will open, click on the green button \sphinxstylestrong{Download Core v.xxx}, where xxx refers to the current version number. This will download a .zip file containing the file \sphinxcode{\sphinxupquote{kickstart.php}}. We will place this php file in the root of our site to restore the Joomla backup.

\end{enumerate}


\section{Preparing your new VPS server to host your website}
\label{\detokenize{joomla-to-vps:preparing-your-new-vps-server-to-host-your-website}}
\begin{figure}[H]
\centering
\capstart

\noindent\sphinxincludegraphics[width=450\sphinxpxdimen]{{spacedog-repairman-mini}.png}
\caption{“Spacedog Repairman” by \sphinxhref{https://katharsisdrill.art}{Katharsisdrill}\sphinxfootnotemark[9] under \sphinxhref{https://creativecommons.org/licenses/by/4.0/}{CC BY 4.0}\sphinxfootnotemark[10] License}\label{\detokenize{joomla-to-vps:id2}}\end{figure}
%
\begin{footnotetext}[9]\phantomsection\label{\thesphinxscope.9}%
\sphinxAtStartFootnote
\sphinxnolinkurl{https://katharsisdrill.art}
%
\end{footnotetext}\ignorespaces %
\begin{footnotetext}[10]\phantomsection\label{\thesphinxscope.10}%
\sphinxAtStartFootnote
\sphinxnolinkurl{https://creativecommons.org/licenses/by/4.0/}
%
\end{footnotetext}\ignorespaces 
\sphinxAtStartPar
You need to test your website on the new VPS before performing the actual domain transfer from your shared hosting to the new VPS.


\subsection{Option 1: Adding an entry to your hosts file}
\label{\detokenize{joomla-to-vps:option-1-adding-an-entry-to-your-hosts-file}}
\sphinxAtStartPar
On linux systems, the \sphinxcode{\sphinxupquote{/etc/hosts}} file maps hostnames to IP addresses.

\sphinxAtStartPar
To edit the hosts file on your system, type the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo nano /etc/hosts
\end{sphinxVerbatim}

\sphinxAtStartPar
Add the following lines to the bottom of the hosts file:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
IP\PYGZus{}address\PYGZus{}of\PYGZus{}your\PYGZus{}VPS  domainname.com
IP\PYGZus{}address\PYGZus{}of\PYGZus{}your\PYGZus{}VPS  www.domainname.com
\end{sphinxVerbatim}

\sphinxAtStartPar
Replace domainname.com by your actual domain name, then press \sphinxcode{\sphinxupquote{Ctrl + O}} to save your changes and \sphinxcode{\sphinxupquote{Ctrl + X}} to close the nano editor.


\subsubsection{Clearing the DNS cache after updating your hosts file}
\label{\detokenize{joomla-to-vps:clearing-the-dns-cache-after-updating-your-hosts-file}}
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
On some Linux systems, you may need to flush the DNS cache in order to update the domain resolution to the new IP address. On Debian\sphinxhyphen{}based distros, caching DNS queries is performed with the \sphinxcode{\sphinxupquote{systemd\sphinxhyphen{}resolved}} daemon.
\end{sphinxadmonition}

\sphinxAtStartPar
To find out if \sphinxcode{\sphinxupquote{systemd\sphinxhyphen{}resolved}} is running on your system, type the following command in your terminal:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemctl is\PYGZhy{}active systemd\PYGZhy{}resolved
\end{sphinxVerbatim}

\sphinxAtStartPar
If the output shows the status \sphinxstylestrong{active}, it means that the daemon is up and running.

\sphinxAtStartPar
To clear the DNS cache, run the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemd\PYGZhy{}resolve \PYGZhy{}\PYGZhy{}flush\PYGZhy{}caches
\end{sphinxVerbatim}

\sphinxAtStartPar
You can now check the cache size with the command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemd\PYGZhy{}resolve \PYGZhy{}\PYGZhy{}statistics
\end{sphinxVerbatim}

\sphinxAtStartPar
The entry \sphinxcode{\sphinxupquote{Current Cache Size: 0}} will appear in the output if the DNS cache has been cleared successfully.


\subsection{Option 2: Adjusting the DNS records}
\label{\detokenize{joomla-to-vps:option-2-adjusting-the-dns-records}}
\sphinxAtStartPar
For testing purposes, you can create a \sphinxcode{\sphinxupquote{DNS Zone}} for your domain on the new VPS server. The \sphinxcode{\sphinxupquote{DNS Zone}} section allows you to configure your domain for the different services that you intend to provide.

\sphinxAtStartPar
Suppose that you already have a domain that is registered with another service provider. To avoid any service interruptions before transferring your domain to a new provider, you can add a DNS zone before you begin the domain name transfer process.

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
Make sure to configure the DNS servers accordingly to take the DNS zone into account.
\end{sphinxadmonition}

\sphinxAtStartPar
Adding a \sphinxcode{\sphinxupquote{DNS Zone}} generally involves the following steps:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Entering a domain name in the \sphinxcode{\sphinxupquote{DNS Zone}} section

\item {} 
\sphinxAtStartPar
Choosing whether you want to enable minimal records, the default is \sphinxcode{\sphinxupquote{No}}

\item {} 
\sphinxAtStartPar
Checking the pricing details

\item {} 
\sphinxAtStartPar
Confirming the Special Terms for the Webdomain and the General terms of service

\end{itemize}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Login to your shared hosting account.

\item {} 
\sphinxAtStartPar
In your cPanel, go to \sphinxstylestrong{Domains} > \sphinxstylestrong{Zone Editor}.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{dns-zone-editor}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
In your \sphinxstylestrong{Zone Editor}, go to \sphinxstylestrong{Actions}, then select the tab \sphinxstylestrong{+A Record}. A new window with the title \sphinxstylestrong{Add an A Record for “yourdomain.com”} will open.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{a-record-dns}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
In the \sphinxstylestrong{Name} field, enter your fully\sphinxhyphen{}qualified domain name (FQDN) by appending a dot at the end of your domain name: \sphinxcode{\sphinxupquote{joomla\sphinxhyphen{}domain.com.}}.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{a-record-dns-name}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
In the \sphinxstylestrong{Address} field, enter the IP address of your new Virtual Private Server (VPS). Remember that you want the DNS server from your shared hosting plan to point to your new VPS. By doing so, you can test if everything is working fine before requesting a domain transfer.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{a-record-dns-address}.png}
\end{figure}
\end{quote}

\end{enumerate}


\subsection{Uploading the required files to your VPS server}
\label{\detokenize{joomla-to-vps:uploading-the-required-files-to-your-vps-server}}
\sphinxAtStartPar
To restore the Joomla website on your new VPS server, you will need these three files:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
The Akeeba backup file with the \sphinxcode{\sphinxupquote{.jpa}} extension

\item {} 
\sphinxAtStartPar
The SQL dump file that we have generated with the Backup Wizard in cPanel

\item {} 
\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{kickstart.php}} file that we have extracted from the Akeeba Kickstart Core

\end{enumerate}

\sphinxAtStartPar
To upload each of these files to your VPS server via ssh, use the \sphinxcode{\sphinxupquote{scp}} command as shown below:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} scp \PYGZhy{}P PORT\PYGZhy{}NUMBER /PATH/TO/FILE USER@IP\PYGZhy{}ADDRESS:PATH/TO/DESIRED/DESTINATION
\end{sphinxVerbatim}

\sphinxAtStartPar
Replace the parameters of the scp command by their actual values, i.e.:


\begin{savenotes}\sphinxattablestart
\centering
\begin{tabular}[t]{|\X{30}{100}|\X{70}{100}|}
\hline
\sphinxstyletheadfamily 
\sphinxAtStartPar
Parameter
&\sphinxstyletheadfamily 
\sphinxAtStartPar
Description
\\
\hline
\sphinxAtStartPar
PORT\sphinxhyphen{}NUMBER
&
\sphinxAtStartPar
the port number your are using to connect to your VPS server through ssh. The default port number for ssh connections is
22, but you can set a different port number for your ssh connection.
\\
\hline
\sphinxAtStartPar
/PATH/TO/FILE
&
\sphinxAtStartPar
the path to the file that you want to upload to your VPS server
\\
\hline
\sphinxAtStartPar
USER
&
\sphinxAtStartPar
The active ssh user. You will find all your ssh credentials in the corresponding section on your customer page. If stil
doubt, contact your VPS provider.
\\
\hline
\sphinxAtStartPar
IP\sphinxhyphen{}ADDRESS
&
\sphinxAtStartPar
The IP address of your VPS server
\\
\hline
\end{tabular}
\par
\sphinxattableend\end{savenotes}


\subsection{Creating an empty MySQL database}
\label{\detokenize{joomla-to-vps:creating-an-empty-mysql-database}}
\sphinxAtStartPar
In the section {\hyperref[\detokenize{joomla-to-vps:performing-the-backup-on-your-shared-hosting-account}]{\sphinxcrossref{Performing the backup on your shared hosting account}}}, you made a backup of your MySQL database. You will now create an empty database on your VPS to import the SQL dump file.

\sphinxAtStartPar
Login to MySQL by typing the following command in your VPS terminal:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} mysql \PYGZhy{}u root \PYGZhy{}p
\end{sphinxVerbatim}

\sphinxAtStartPar
Once you enter your password, you will get access to the MySQL shell prompt. Now, you will create a new database with the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{mysql}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{k}{CREATE}\PYG{+w}{ }\PYG{k}{DATABASE}\PYG{+w}{ }\PYG{n}{new\PYGZus{}database}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
You can replace the value \sphinxtitleref{new\_database} by a name that suits your needs. When choosing a name for your MySQL database, follow these naming convention rules:
\begin{itemize}
\item {} 
\sphinxAtStartPar
Use lowercase

\item {} 
\sphinxAtStartPar
Use only alphabetical characters

\item {} 
\sphinxAtStartPar
Do not use numeric characters

\item {} 
\sphinxAtStartPar
Avoid using prefixes

\item {} 
\sphinxAtStartPar
Give your database a self\sphinxhyphen{}explanatory name

\end{itemize}
\end{sphinxadmonition}

\sphinxAtStartPar
If everything went fine, the shell prompt will display the following output:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{k}{Output}
\PYG{n}{Query}\PYG{+w}{ }\PYG{n}{OK}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{+w}{ }\PYG{k}{row}\PYG{+w}{ }\PYG{n}{affected}\PYG{+w}{ }\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{.}\PYG{l+m+mi}{00}\PYG{+w}{ }\PYG{n}{sec}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Importing the SQL dump into your new database}
\label{\detokenize{joomla-to-vps:importing-the-sql-dump-into-your-new-database}}
\sphinxAtStartPar
We will now assign a user \sphinxtitleref{bob} to our newly created database by typing the command below. Make sure to change the username \sphinxcode{\sphinxupquote{bob}} and the deafult \sphinxcode{\sphinxupquote{password}} to a strong password of your own:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{mysql}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{k}{CREATE}\PYG{+w}{ }\PYG{k}{USER}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}bob\PYGZsq{}}\PYG{o}{@}\PYG{l+s+s1}{\PYGZsq{}localhost\PYGZsq{}}\PYG{+w}{ }\PYG{n}{IDENTIFIED}\PYG{+w}{ }\PYG{k}{BY}\PYG{+w}{ }\PYG{l+s+s1}{\PYGZsq{}password\PYGZsq{}}\PYG{p}{;}
\end{sphinxVerbatim}

\sphinxAtStartPar
Use the key combination \sphinxcode{\sphinxupquote{Ctrl + D}} to leave the MySQL shell prompt.

\sphinxAtStartPar
In the VPS terminal, you can now import the SQL dump file with the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} mysql \PYGZhy{}u \PYG{l+s+s1}{\PYGZsq{}username\PYGZsq{}} \PYGZhy{}p \PYG{l+s+s1}{\PYGZsq{}new\PYGZus{}database\PYGZsq{}} \PYGZlt{} \PYG{l+s+s1}{\PYGZsq{}data\PYGZhy{}dump.sql\PYGZsq{}}
\end{sphinxVerbatim}


\subsection{Setting up a virtual host on your VPS}
\label{\detokenize{joomla-to-vps:setting-up-a-virtual-host-on-your-vps}}
\sphinxAtStartPar
At the beginning of this guide, we mentioned in the {\hyperref[\detokenize{joomla-to-vps:requirements}]{\sphinxcrossref{\DUrole{std,std-ref}{Requirements}}}} section that we will use Apache as a web server in our stack. Apache allows you to configure multiple virtual hosts, making it possible to host more than one domain on a single server.

\sphinxAtStartPar
In our particular scenario, this means that we can host all the following domains on our VPS, as long we have sufficient storage, RAM, CPU, and IOPS resources:
\begin{itemize}
\item {} 
\sphinxAtStartPar
techwriting\sphinxhyphen{}website.com

\item {} 
\sphinxAtStartPar
webdev\sphinxhyphen{}website.net

\item {} 
\sphinxAtStartPar
infosec\sphinxhyphen{}website.org

\item {} 
\sphinxAtStartPar
etc.

\end{itemize}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Before you set up a virtual host, make sure that Apache is up and running on your VPS. To do so, type the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemctl start apache2
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
To start the Apache2 server automatically on boot, use the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemctl \PYG{n+nb}{enable} apache2
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
From now on, you will have to create a dedicated folder under \sphinxcode{\sphinxupquote{/var/www}} for each new domain that you want to host on your VPS. For instance, to create the domain that will host your Joomla backup on the new VPS, type the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo mkdir /var/www/joomla\PYGZhy{}domain
\end{sphinxVerbatim}

\sphinxAtStartPar
Replace the parameter \sphinxcode{\sphinxupquote{joomla\sphinxhyphen{}domain}} by the actual domain name that your are using for your Joomla website.

\item {} 
\sphinxAtStartPar
Assign ownership of the newly created directory with the \sphinxcode{\sphinxupquote{\$USER}} environment variable by using the command below. The \sphinxcode{\sphinxupquote{\$USER}} environment variable is identical to the \sphinxcode{\sphinxupquote{\$LOGNAME}} environment variable, which represents the currently logged\sphinxhyphen{}in user:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo chown \PYGZhy{}R \PYG{n+nv}{\PYGZdl{}USER}:\PYG{n+nv}{\PYGZdl{}USER} /var/www/joomla\PYGZhy{}domain
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
Make sure that you granted the correct web root permissions by typing the command below. The folder’s owner should have \sphinxstylestrong{read/write/execute} permissions, while group and others should only have \sphinxstylestrong{read/execute} privileges.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo chmod \PYGZhy{}R \PYG{l+m}{755} /var/www/joomla\PYGZhy{}domain
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The default permissions on a web server are 755 for directories and 644 for files.
\end{sphinxadmonition}

\item {} 
\sphinxAtStartPar
In order for Apache to serve your content, you need to create an “Apache virtual host configuration file”. To do so, we will create a new empty file with the nano editor:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo nano /etc/apache2/sites\PYGZhy{}available/joomla\PYGZhy{}domain.conf
\end{sphinxVerbatim}

\sphinxAtStartPar
Put the following directives inside the configuration file:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYGZlt{}VirtualHost *:80\PYGZgt{}
ServerAdmin webadmin@localhost
ServerName joomla\PYGZhy{}domain
ServerAlias www.joomla\PYGZhy{}domain
DocumentRoot /var/www/joomla\PYGZhy{}domain
ErrorLog \PYG{l+s+si}{\PYGZdl{}\PYGZob{}}\PYG{n+nv}{APACHE\PYGZus{}LOG\PYGZus{}DIR}\PYG{l+s+si}{\PYGZcb{}}/error.log
CustomLog \PYG{l+s+si}{\PYGZdl{}\PYGZob{}}\PYG{n+nv}{APACHE\PYGZus{}LOG\PYGZus{}DIR}\PYG{l+s+si}{\PYGZcb{}}/access.log combined
\PYGZlt{}/VirtualHost\PYGZgt{}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The email provided in the field ServerAdmin$^{\text{{[}2{]}}}$ is a placeholder. Make sure to use a working email address where the administrator of your Joomla domain can receive notifications. Also replace the parameters \sphinxcode{\sphinxupquote{joomla\sphinxhyphen{}domain}}$^{\text{{[}3{]}}}$ and \sphinxcode{\sphinxupquote{www.joomla\sphinxhyphen{}domain}}$^{\text{{[}4{]}}}$ by the actual domain name of your Joomla website.
\end{sphinxadmonition}

\sphinxAtStartPar
Once you have entered the relevant information, press \sphinxcode{\sphinxupquote{Ctrl + O}} to save your changes and \sphinxcode{\sphinxupquote{Ctrl + X}} to close the nano editor.

\item {} 
\sphinxAtStartPar
We will now use a sample \sphinxcode{\sphinxupquote{index.html}} file to check if our virtual host is working properly. To do so, we will create a new empty file with the nano editor:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo nano /var/www/joomla\PYGZhy{}domain/index.html
\end{sphinxVerbatim}

\sphinxAtStartPar
Add the following lines in the empty file:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
  \PYG{p}{\PYGZlt{}}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}Welcome to my joomla\PYGZhy{}domain\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
  \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
  \PYG{p}{\PYGZlt{}}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{h1}\PYG{p}{\PYGZgt{}}The joomla\PYGZhy{}domain virtual host is up and running\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{h1}\PYG{p}{\PYGZgt{}}
  \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{a2ensite} is a script that allows you to enable a specific site within the Apache2 configuration. This is achieved by creating symlinks (short for symbolic links) within the \sphinxcode{\sphinxupquote{/etc/apache2/sites\sphinxhyphen{}enabled}} directory.

\sphinxAtStartPar
We will use \sphinxstylestrong{a2ensite} to enable our newly created site on the VPS. To do so, type the command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo a2ensite joomla\PYGZhy{}domain.conf
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
In the same manner that \sphinxstylestrong{a2ensite} adds symbolic links to enable a specific site, \sphinxstylestrong{a2dissite} removes symbolic links to disable a site.

\sphinxAtStartPar
In our particular case, we will use a2dissite to disable the default configuration file called \sphinxcode{\sphinxupquote{000\sphinxhyphen{}default.conf}}.

\sphinxAtStartPar
This default file is a fallback for all the requests that do not specify a configuration file.

\sphinxAtStartPar
To disable the default configuration file, type the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo a2dissite \PYG{l+m}{000}\PYGZhy{}default.conf
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
Make sure that your configuration does not contain any erros by running the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo apache2ctl configtest
\end{sphinxVerbatim}

\sphinxAtStartPar
If everything is fine, you should get the following output:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
Output
Syntax OK
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
Each time you modify the Apache configuration, you need to restart the Apache service. Use the following command to restart Apache:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemctl restart apache2
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
To check that the web server is serving your content now, go to \sphinxcode{\sphinxupquote{http://joomla\sphinxhyphen{}domain}} in your browser. You should see the following output:
\begin{quote}

\sphinxAtStartPar
\sphinxstylestrong{The joomla\sphinxhyphen{}domain virtual host is up and running}
\end{quote}

\end{enumerate}


\section{Restoring your Joomla website on the VPS}
\label{\detokenize{joomla-to-vps:restoring-your-joomla-website-on-the-vps}}
\sphinxAtStartPar
To restore your Joomla website on the VPS server, you first have to move the file \sphinxcode{\sphinxupquote{kickstart.php}} and your Akeeba backup file \sphinxcode{\sphinxupquote{backup\sphinxhyphen{}file.jpa}} to the root of your site on the VPS, i.e. inside the folder \sphinxcode{\sphinxupquote{/var/www/joomla\sphinxhyphen{}domain}}.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
If you have not already placed both files in the root of your Joomla site, open the terminal, then navigate to the folder containing both files. Next, type the following commands:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYGZdl{} sudo mv kickstart.php /var/www/joomla\PYGZhy{}domain
\PYGZdl{} sudo mv backup\PYGZhy{}file.jpa /var/www/joomla\PYGZhy{}domain
\end{sphinxVerbatim}

\sphinxAtStartPar
Replace the parameter \sphinxcode{\sphinxupquote{backup\sphinxhyphen{}file.jpa}} by the actual backup file name.

\item {} 
\sphinxAtStartPar
In your browser, type the following address:

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{http://joomla\sphinxhyphen{}domain/kickstart.php}}

\item {} 
\sphinxAtStartPar
The welcome screen of Akeeba Kickstart appears. Press the button \sphinxstylestrong{Click here or press ESC to close this message} on the bottom left.

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-welcome-screen}.png}
\end{figure}

\item {} 
\sphinxAtStartPar
The graphical interface of the \sphinxstylestrong{Akeeba archive extraction tool} will appear on your browser screen.

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-extract-page}.png}
\end{figure}

\item {} 
\sphinxAtStartPar
Scroll to the bottom of the screen, then click on the \sphinxstylestrong{Start} green button under the section \sphinxstylestrong{Extract files}.

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-extract-button-2}.png}
\end{figure}

\item {} 
\sphinxAtStartPar
The extraction progress window will appear. Once the files are extracted, click on the green button \sphinxstylestrong{Run the Installer} under \sphinxstylestrong{Restoration and Cleanup}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-extracting-bar}.png}
\end{figure}

\item {} 
\sphinxAtStartPar
The site restoration script of Akeeba Backup will perform a pre\sphinxhyphen{}installation check. This allows you to take the necessary actions to correct any possible issues. If everything is fine, press the button \sphinxstylestrong{→ Next} on the top right side of the screen.

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-preinstallation-check}.png}
\end{figure}

\item {} 
\sphinxAtStartPar
In the screen that appears, enter the {\hyperref[\detokenize{joomla-to-vps:credentials}]{\sphinxcrossref{\DUrole{std,std-ref}{credentials}}}} for the MySQL database that you have created. Once you have entered all the required information, click on the button \sphinxstylestrong{→ Next} on the top right side of the screen.

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-restoration-database}.png}
\end{figure}

\item {} 
\sphinxAtStartPar
A \sphinxstylestrong{Database Restoration Progress Bar} will appear. If the restoration was successful, you wil see the message: \sphinxstylestrong{The database restoration was successful}.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-database-progress}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
In the screen that appears, enter the site parameters such as “Site name” and “Live site URL”. Once you have entered all the required information, click on the button \sphinxstylestrong{→ Next} on the top right side of the screen.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{kickstart-site-parameters}.png}
\end{figure}
\end{quote}

\item {} 
\sphinxAtStartPar
If the restoration process has completed successfully, you will see the creen below. You can now visit you site’s frontend or login to the site’s backend.
\begin{quote}

\begin{figure}[H]
\centering

\noindent\sphinxincludegraphics{{restoration-cleanup-akeeba}.png}
\end{figure}
\end{quote}

\end{enumerate}


\section{Installing Let’s Encrypt certificates with Certbot}
\label{\detokenize{joomla-to-vps:installing-let-s-encrypt-certificates-with-certbot}}
\sphinxAtStartPar
Now that you have restored your Joomla website, remember that you had to {\hyperref[\detokenize{joomla-to-vps:disable-ssl}]{\sphinxcrossref{disable SSL}}} before making the backup with Akeeba.
To protect your website, you can install TLS/SSL certificates from Let’s Encrypt.

\sphinxAtStartPar
Let’s Encrypt is a non\sphinxhyphen{}profit and open certificate authority managed by the \sphinxhref{https://www.abetterinternet.org/}{Internet Security Research Group}%
\begin{footnote}[11]\sphinxAtStartFootnote
\sphinxnolinkurl{https://www.abetterinternet.org/}
%
\end{footnote}, a public\sphinxhyphen{}benefit corporation based in California.

\sphinxAtStartPar
To issue the TLS/SSL certificates and install them automatically on the web server, we are going to use Certbot, an open\sphinxhyphen{}source software developed by the \sphinxhref{https://www.eff.org/}{Electronic Frontier Foundation}%
\begin{footnote}[12]\sphinxAtStartFootnote
\sphinxnolinkurl{https://www.eff.org/}
%
\end{footnote}.

\begin{figure}[H]
\centering
\capstart

\noindent\sphinxincludegraphics{{certbot}.jpg}
\caption{Picture by the Electronic Frontier Foundation under \sphinxhref{https://creativecommons.org/licenses/by/2.0/}{CC BY 2.0}\sphinxfootnotemark[13] License}\label{\detokenize{joomla-to-vps:id3}}\end{figure}
%
\begin{footnotetext}[13]\phantomsection\label{\thesphinxscope.13}%
\sphinxAtStartFootnote
\sphinxnolinkurl{https://creativecommons.org/licenses/by/2.0/}
%
\end{footnotetext}\ignorespaces 
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Before you follow the instructions below, make sure HTTPS traffic is allowed by your firewall. The default port number for HTTPS traffic is 443.
\end{sphinxadmonition}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
In your terminal, run the following command to install Certbot with the plugin that allows the integration with the Apache web server:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo apt install certbot python3\PYGZhy{}certbot\PYGZhy{}apache
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Press \sphinxcode{\sphinxupquote{Y}}, then \sphinxcode{\sphinxupquote{Enter}} to run the installation.

\item {} 
\sphinxAtStartPar
To issue a certificate and reconfigure apache automatically, run the command:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo certbot \PYGZhy{}\PYGZhy{}apache
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Carefully read the questions that will appear on your terminal. Provide a valid email address.

\item {} 
\sphinxAtStartPar
Agree to the “Terms of Service” by pressing \sphinxcode{\sphinxupquote{A}} (short for Agree).

\item {} 
\sphinxAtStartPar
Choose whether you want to share your email address with the Electronic Frontier Foundation by pressing \sphinxcode{\sphinxupquote{Y}} to confirm or \sphinxcode{\sphinxupquote{N}} to refuse.

\item {} 
\sphinxAtStartPar
You will then get the output shown below. Indicate the domains that you want to enable HTTPS for by selecting the appropriate listed numbers:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Plugins selected: Authenticator apache, Installer apache

Which names would you like to activate HTTPS \PYG{k}{for}?
\PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{}
\PYG{l+m}{1}: joomla\PYGZhy{}domain.com
\PYG{l+m}{2}: www.joomla\PYGZhy{}domain.com
\PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{}
Select the appropriate numbers separated by commas and/or spaces, or leave input
blank to \PYG{k}{select} all options shown \PYG{o}{(}Enter \PYG{l+s+s1}{\PYGZsq{}c\PYGZsq{}} to cancel\PYG{o}{)}: c
Please specify \PYGZhy{}\PYGZhy{}domains, or \PYGZhy{}\PYGZhy{}installer that will \PYG{n+nb}{help} \PYG{k}{in} domain names autodiscovery, or \PYGZhy{}\PYGZhy{}cert\PYGZhy{}name \PYG{k}{for} an existing certificate name.
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
In the next prompt that appears, choose whether or not you want to force redirecting HTTP to HTTPS traffic.
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
\PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{}
\PYG{l+m}{1}: No redirect \PYGZhy{} Make no further changes to the webserver configuration.
\PYG{l+m}{2}: Redirect \PYGZhy{} Make all requests redirect to secure HTTPS access. Choose this \PYG{k}{for}
new sites, or \PYG{k}{if} you\PYG{l+s+s1}{\PYGZsq{}re confident your site works on HTTPS. You can undo this}
\PYG{l+s+s1}{change by editing your web server\PYGZsq{}}s configuration.
\PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{}
Select the appropriate number \PYG{o}{[}\PYG{l+m}{1}\PYGZhy{}2\PYG{o}{]} \PYG{k}{then} \PYG{o}{[}enter\PYG{o}{]} \PYG{o}{(}press \PYG{l+s+s1}{\PYGZsq{}c\PYGZsq{}} to cancel\PYG{o}{)}:
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Once you have answered all the questions, Certbot will start the installation.

\item {} 
\sphinxAtStartPar
If the installation was successful, you will get the following output:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{}
Congratulations! You have successfully enabled https://www.joomla\PYGZhy{}domain.com

You should test your configuration at:
https://www.ssllabs.com/ssltest/analyze.html?d=www.joomla\PYGZhy{}domain.com
\PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{} \PYGZhy{}

IMPORTANT NOTES:
 \PYGZhy{} Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/www.joomla\PYGZhy{}domain.com/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/www.joomla\PYGZhy{}domain.com/privkey.pem
   Your cert will expire on 2022\PYGZhy{}10\PYGZhy{}25. To obtain a new or tweaked
   version of this certificate in the future, simply run certbot again
   with the \PYGZdq{}certonly\PYGZdq{} option. To non\PYGZhy{}interactively renew *all* of
   your certificates, run \PYGZdq{}certbot renew\PYGZdq{}
 \PYGZhy{} If you like Certbot, please consider supporting our work by:

   Donating to ISRG / Let\PYGZsq{}s Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate\PYGZhy{}le
\end{sphinxVerbatim}
\end{quote}

\end{enumerate}

\sphinxAtStartPar
Certbot has now installed your TLS/SSL certificate and configured Apache accordingly.

\sphinxstepscope


\chapter{Hardening Apache on an unmanaged VPS}
\label{\detokenize{hardening-apache:hardening-apache-on-an-unmanaged-vps}}\label{\detokenize{hardening-apache::doc}}
\sphinxAtStartPar
Published on May 22, 2022 by Fayçal Alami\sphinxhyphen{}Hassani \sphinxhref{https://fosstodon.org/@gnufcl}{@gnufcl@fosstodon.org}%
\begin{footnote}[14]\sphinxAtStartFootnote
\sphinxnolinkurl{https://fosstodon.org/@gnufcl}
%
\end{footnote}

\begin{figure}[H]
\centering
\capstart

\noindent\sphinxincludegraphics{{scifi-ball-mini}.png}
\caption{Picture by \sphinxhref{https://www.blendswap.com/profile/636833}{J4747}\sphinxfootnotemark[15] under \sphinxhref{https://creativecommons.org/licenses/by/4.0/}{CC BY}\sphinxfootnotemark[16] License}\label{\detokenize{hardening-apache:id1}}\end{figure}
%
\begin{footnotetext}[15]\phantomsection\label{\thesphinxscope.15}%
\sphinxAtStartFootnote
\sphinxnolinkurl{https://www.blendswap.com/profile/636833}
%
\end{footnotetext}\ignorespaces %
\begin{footnotetext}[16]\phantomsection\label{\thesphinxscope.16}%
\sphinxAtStartFootnote
\sphinxnolinkurl{https://creativecommons.org/licenses/by/4.0/}
%
\end{footnotetext}\ignorespaces 
\sphinxAtStartPar
This guide is a follow\sphinxhyphen{}up to the post published last week about {\hyperref[\detokenize{joomla-to-vps::doc}]{\sphinxcrossref{\DUrole{doc}{Migrating a Joomla website from shared hosting to an unmanaged VPS}}}}. In this tutorial, you will learn how to implement a set of security measures to protect your Apache web server on Debian\sphinxhyphen{}based Linux systems.


\section{Prerequisites}
\label{\detokenize{hardening-apache:prerequisites}}
\sphinxAtStartPar
This tutorial assumes that you already have the following:
\begin{itemize}
\item {} 
\sphinxAtStartPar
LAMP stack installed on your VPS server. LAMP is short for “Linux + Apache + MySQL + PHP”.

\item {} 
\sphinxAtStartPar
Non\sphinxhyphen{}root user with sudo privileges on your VPS server.

\item {} 
\sphinxAtStartPar
SSH access to your VPS server.

\end{itemize}

\sphinxAtStartPar
Before you follow this guide, make sure to configure your environment accordingly.


\section{Running Apache with an unprivileged user}
\label{\detokenize{hardening-apache:running-apache-with-an-unprivileged-user}}
\sphinxAtStartPar
The “principle of least privilege” is a security best practice in the context of server administration. According to this principle, you should grant users only the strict minimum of permissions they need to perform their tasks. Therefore, running your Apache web server with a non\sphinxhyphen{}root user helps you prevent abusive access to the system.

\sphinxAtStartPar
To manage user and group privileges on your server, you need to access the \sphinxcode{\sphinxupquote{envvars}} file. This file contains the environment variables of your Apache web server.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
First, type the following command in your terminal:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo nano /etc/apache2/envvars
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
In the file that opens, navigate to the following lines:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{c+c1}{\PYGZsh{} Since there is no sane way to get the parsed apache2 config in scripts, some}
\PYG{c+c1}{\PYGZsh{} settings are defined via environment variables and then used in apache2ctl,}
\PYG{c+c1}{\PYGZsh{} /etc/init.d/apache2, /etc/logrotate.d/apache2, etc.}
\PYG{n+nb}{export} \PYG{n+nv}{APACHE\PYGZus{}RUN\PYGZus{}USER}\PYG{o}{=}apache
\PYG{n+nb}{export} \PYG{n+nv}{APACHE\PYGZus{}RUN\PYGZus{}GROUP}\PYG{o}{=}apache
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
Set the variables \sphinxcode{\sphinxupquote{APACHE\_RUN\_USER}} and \sphinxcode{\sphinxupquote{APACHE\_RUN\_GROUP}} to a non\sphinxhyphen{}root user and group, respectively.

\sphinxAtStartPar
The table below illustrates some possible values for a non\sphinxhyphen{}root \sphinxcode{\sphinxupquote{user}} and \sphinxcode{\sphinxupquote{group}}:


\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|T|}
\hline
\sphinxstyletheadfamily 
\sphinxAtStartPar
↓ Value Pair / Environment Variable →
&\sphinxstyletheadfamily 
\sphinxAtStartPar
APACHE\_RUN\_USER
&\sphinxstyletheadfamily 
\sphinxAtStartPar
APACHE\_RUN\_GROUP
\\
\hline
\sphinxAtStartPar
VALUE PAIR 1
&
\sphinxAtStartPar
apache
&
\sphinxAtStartPar
apache
\\
\hline
\sphinxAtStartPar
VALUE PAIR 2
&
\sphinxAtStartPar
nobody
&
\sphinxAtStartPar
nogroup
\\
\hline
\sphinxAtStartPar
VALUE PAIR 3
&
\sphinxAtStartPar
www\sphinxhyphen{}data
&
\sphinxAtStartPar
www\sphinxhyphen{}data
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}

\end{enumerate}


\section{Hiding your operating system and Apache version}
\label{\detokenize{hardening-apache:hiding-your-operating-system-and-apache-version}}
\sphinxAtStartPar
Each time a user connects to your website, your server sends so\sphinxhyphen{}called \sphinxstyleemphasis{response headers} to the user’s browser. Response headers are HTTP headers containing metadata that is not related to the main message being exchanged between the client and your server.

\sphinxAtStartPar
In the default configuration, your web server exposes sensitive information about your infrastructure such as the operating system (OS) and the Apache version installed on the server.

\sphinxAtStartPar
You can check this by using a tool such as \sphinxhref{https://curl.se/}{cURL}%
\begin{footnote}[17]\sphinxAtStartFootnote
\sphinxnolinkurl{https://curl.se/}
%
\end{footnote}. In your terminal, type the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} curl \PYGZhy{}IL your\PYGZhy{}domain\PYGZhy{}name
\end{sphinxVerbatim}

\sphinxAtStartPar
You should then get an output like the one below. Note that the details of your OS and Apache version appear on lines number 3 and 9 under the \sphinxcode{\sphinxupquote{Server}} entry:

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
HTTP/1.1 \PYG{l+m}{301} Moved Permanently
Date: Sun, \PYG{l+m}{22} May \PYG{l+m}{2022} \PYG{l+m}{19}:57:25 GMT
Server: Apache/2.4.25 \PYG{o}{(}Debian\PYG{o}{)}
Location: https://your\PYGZhy{}domain\PYGZhy{}name/
Content\PYGZhy{}Type: text/html\PYG{p}{;} \PYG{n+nv}{charset}\PYG{o}{=}iso\PYGZhy{}8859\PYGZhy{}1

HTTP/1.1 \PYG{l+m}{200} OK
Date: Sun, \PYG{l+m}{22} May \PYG{l+m}{2022} \PYG{l+m}{19}:57:25 GMT
Server: Apache/2.4.25 \PYG{o}{(}Debian\PYG{o}{)}
Expires: Wed, \PYG{l+m}{17} Aug \PYG{l+m}{2005} \PYG{l+m}{00}:00:00 GMT
Last\PYGZhy{}Modified: Sun, \PYG{l+m}{22} May \PYG{l+m}{2022} \PYG{l+m}{19}:57:25 GMT
Cache\PYGZhy{}Control: xxx, xxx, xxx\PYGZhy{}xxx, xxxxxxx, xxxxxxxx
Pragma: no\PYGZhy{}cache
X\PYGZhy{}Content\PYGZhy{}Type\PYGZhy{}Options: nosniff
X\PYGZhy{}Frame\PYGZhy{}Options: sameorigin
Content\PYGZhy{}Type: text/html\PYG{p}{;} \PYG{n+nv}{charset}\PYG{o}{=}utf\PYGZhy{}8
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
To hide your operating system and Apache version, you need to adjust the settings of your \sphinxcode{\sphinxupquote{apache2.conf}} file. To revert your settings to their initial state in case of a faulty configuration, you should first make a backup of this file with the following command:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo cp /etc/apache2/apache2.conf /etc/apache2/apache2\PYGZus{}bak.conf
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Next, open the \sphinxcode{\sphinxupquote{apache2.conf}} file by typing this command in your terminal:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo nano /etc/apache2/apache2.conf
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
In the file that opens, scroll down to the bottom and add the following two lines:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
ServerTokens Prod
ServerSignature Off
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Press \sphinxcode{\sphinxupquote{Ctrl + O}} to save your changes and \sphinxcode{\sphinxupquote{Ctrl + X}} to close the nano editor.

\item {} 
\sphinxAtStartPar
Run the following command to restart Apache:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemctl restart apache2
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
In your terminal, retype the following command:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} curl \PYGZhy{}IL your\PYGZhy{}domain\PYGZhy{}name
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
The new output should now look like this:

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
HTTP/1.1 \PYG{l+m}{301} Moved Permanently
Date: Sun, \PYG{l+m}{22} May \PYG{l+m}{2022} \PYG{l+m}{19}:57:25 GMT
Server: Apache
Location: https://your\PYGZhy{}domain\PYGZhy{}name/
Content\PYGZhy{}Type: text/html\PYG{p}{;} \PYG{n+nv}{charset}\PYG{o}{=}iso\PYGZhy{}8859\PYGZhy{}1

HTTP/1.1 \PYG{l+m}{200} OK
Date: Sun, \PYG{l+m}{22} May \PYG{l+m}{2022} \PYG{l+m}{19}:57:25 GMT
Server: Apache
Expires: Wed, \PYG{l+m}{17} Aug \PYG{l+m}{2005} \PYG{l+m}{00}:00:00 GMT
Last\PYGZhy{}Modified: Sun, \PYG{l+m}{22} May \PYG{l+m}{2022} \PYG{l+m}{19}:57:25 GMT
Cache\PYGZhy{}Control: xxx, xxx, xxx\PYGZhy{}xxx, xxxxxxx, xxxxxxxx
Pragma: no\PYGZhy{}cache
X\PYGZhy{}Content\PYGZhy{}Type\PYGZhy{}Options: nosniff
X\PYGZhy{}Frame\PYGZhy{}Options: sameorigin
Content\PYGZhy{}Type: text/html\PYG{p}{;} \PYG{n+nv}{charset}\PYG{o}{=}utf\PYGZhy{}8
\end{sphinxVerbatim}

\sphinxAtStartPar
Note that your OS and Apache version details have disappeared from lines 3 and 9. The \sphinxcode{\sphinxupquote{Server}} entry only shows \sphinxstylestrong{Apache} without any further details.


\section{Disabling open directory listings}
\label{\detokenize{hardening-apache:disabling-open-directory-listings}}
\sphinxAtStartPar
If a directory inside your filesystem lacks an index file such as \sphinxcode{\sphinxupquote{index.html}} or \sphinxcode{\sphinxupquote{index.php}}, the web server automatically generates a listing of that particular directory. When this feature is enabled, intruders and eavesdroppers can explore the content of your folders to spot any existing vulnerabilities.

\begin{figure}[H]
\centering
\capstart

\noindent\sphinxincludegraphics{{index-of}.png}
\caption{An example of an open directory listing}\label{\detokenize{hardening-apache:id2}}\end{figure}

\sphinxAtStartPar
To protect your directory content against curious eyes, you need to modify the configuration of your \sphinxcode{\sphinxupquote{apache2.conf}} file.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
Open the file with your nano editor by typing the following command:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo nano /etc/apache2/apache2.conf
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
In the file that opens, scroll down to the following directive block:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}Directory /var/www/\PYGZgt{}
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
\PYGZlt{}/Directory\PYGZgt{}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Add a minus sign “\sphinxhyphen{}” before the keywords \sphinxcode{\sphinxupquote{Indexes}} and \sphinxcode{\sphinxupquote{FollowSymLinks}} to prevent Apache from generating open directory listings and following symbolic links. The result should look like this:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}Directory /var/www/\PYGZgt{}
        Options \PYGZhy{}Indexes \PYGZhy{}FollowSymLinks
        AllowOverride None
        Require all granted
\PYGZlt{}/Directory\PYGZgt{}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Press \sphinxcode{\sphinxupquote{Ctrl + O}} to save your changes and \sphinxcode{\sphinxupquote{Ctrl + X}} to close the nano editor.

\item {} 
\sphinxAtStartPar
Restart Apache with the following command:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemctl restart apache2
\end{sphinxVerbatim}
\end{quote}

\end{enumerate}


\section{Installing a web application firewall}
\label{\detokenize{hardening-apache:installing-a-web-application-firewall}}
\sphinxAtStartPar
A web application firewall (WAF) protects your applications from malicious attacks by scanning and filtering HTTP traffic. ModSecurity is an open source WAF that provides multiple security features including monitoring, logging, and real\sphinxhyphen{}time traffic inspection. You can install ModSecurity on your Apache web server with the free module \sphinxcode{\sphinxupquote{mod\_security2}}.
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
To install \sphinxcode{\sphinxupquote{mod\_security2}} on Debian\sphinxhyphen{}based distributions, type the following command in your terminal:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo apt install lib\PYGZhy{}apache2\PYGZhy{}mod\PYGZhy{}security2
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Check if \sphinxcode{\sphinxupquote{mod\_security2}} is up and running on your system by running the command:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo apachectl \PYGZhy{}M | grep \PYGZhy{}\PYGZhy{}color security
\end{sphinxVerbatim}

\sphinxAtStartPar
You should get the following output:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} security2\PYGZus{}module (shared)
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
When you install \sphinxcode{\sphinxupquote{mod\_security2}} for the first time, ModSecurity runs in detection\sphinxhyphen{}only mode. That is, it detects and logs suspicious activity, and no more than that. To block unwanted traffic, you need to modify the default ModSecurity configuration file: \sphinxcode{\sphinxupquote{modsecurity.conf\sphinxhyphen{}recommended}}.
\end{sphinxadmonition}
\end{quote}

\item {} 
\sphinxAtStartPar
Rename the file \sphinxcode{\sphinxupquote{modsecurity.conf\sphinxhyphen{}recommended}} to \sphinxcode{\sphinxupquote{modsecurity.conf}} by typing the command below:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} mv /etc/modsecurity/modsecurity.conf\PYGZob{}\PYGZhy{}recommended,\PYGZcb{}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Open the new file with your nano editor:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} nano /etc/modsecurity/modsecurity.conf
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
In the file that opens, navigate to the directive:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
``SecRuleEngine DetectionOnly``
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
Replace the value \sphinxstylestrong{DetectionOnly} by the new value \sphinxstylestrong{On}.

\item {} 
\sphinxAtStartPar
Press \sphinxcode{\sphinxupquote{Ctrl + O}} to save your changes and \sphinxcode{\sphinxupquote{Ctrl + X}} to close the nano editor.

\item {} 
\sphinxAtStartPar
Restart Apache with the following command:
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZdl{} sudo systemctl restart apache2
\end{sphinxVerbatim}
\end{quote}

\end{enumerate}

\sphinxAtStartPar
From now on, ModSecurity will also block unwanted traffic.



\renewcommand{\indexname}{Index}
\footnotesize\raggedright\printindex
\end{sloppypar}
\end{document}